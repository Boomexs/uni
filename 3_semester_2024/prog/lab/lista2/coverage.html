
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>docs: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">rwlodarczyk.pl/library/docs/docs.go (100.0%)</option>
				
				<option value="file1">rwlodarczyk.pl/library/http.go (0.0%)</option>
				
				<option value="file2">rwlodarczyk.pl/library/library.go (100.0%)</option>
				
				<option value="file3">rwlodarczyk.pl/library/main.go (0.0%)</option>
				
				<option value="file4">rwlodarczyk.pl/library/storage.go (63.9%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">// Package docs Code generated by swaggo/swag. DO NOT EDIT
package docs

import "github.com/swaggo/swag"

const docTemplate = `{
    "schemes": {{ marshal .Schemes }},
    "swagger": "2.0",
    "info": {
        "description": "{{escape .Description}}",
        "title": "{{.Title}}",
        "termsOfService": "https://github.com/Rafisto/uni",
        "contact": {
            "name": "API Support",
            "url": "https://github.com/Rafisto",
            "email": "rvrelay@gmail.com"
        },
        "version": "{{.Version}}"
    },
    "host": "{{.Host}}",
    "basePath": "{{.BasePath}}",
    "paths": {
        "/books": {
            "get": {
                "description": "Get all books",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "get"
                ],
                "summary": "Get all books",
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/main.Book"
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    }
                }
            },
            "post": {
                "description": "Create a new book",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "create"
                ],
                "summary": "Create a new book",
                "parameters": [
                    {
                        "description": "HTTPError object",
                        "name": "book",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/main.NewBook"
                        }
                    }
                ],
                "responses": {
                    "201": {
                        "description": "Created",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPMessage"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    }
                }
            }
        },
        "/books/{id}": {
            "get": {
                "description": "Get a book",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "get"
                ],
                "summary": "Get a book",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/main.Book"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    }
                }
            },
            "delete": {
                "description": "Delete a book",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "delete"
                ],
                "summary": "Delete a book",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPMessage"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    }
                }
            }
        },
        "/books/{id}/copies": {
            "post": {
                "description": "Create a new copy",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "create"
                ],
                "summary": "Create a new copy",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Book ID",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "201": {
                        "description": "Created",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPMessage"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    }
                }
            }
        },
        "/borrow": {
            "post": {
                "description": "Borrow a book",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "post"
                ],
                "summary": "Borrow a book",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Book ID",
                        "name": "book_id",
                        "in": "query",
                        "required": true
                    },
                    {
                        "type": "integer",
                        "description": "Reader ID",
                        "name": "reader_id",
                        "in": "query",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPMessage"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    }
                }
            }
        },
        "/copies": {
            "get": {
                "description": "Get all copies",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "get"
                ],
                "summary": "Get all copies",
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/main.BookCopy"
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    }
                }
            }
        },
        "/copies/{id}": {
            "delete": {
                "description": "Delete a copy",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "delete"
                ],
                "summary": "Delete a copy",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Copy ID",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPMessage"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    }
                }
            }
        },
        "/readers": {
            "get": {
                "description": "Get all readers",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "get"
                ],
                "summary": "Get all readers",
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/main.Reader"
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    }
                }
            },
            "post": {
                "description": "Create a new reader",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "create"
                ],
                "summary": "Create a new reader",
                "parameters": [
                    {
                        "description": "Reader object",
                        "name": "reader",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/main.NewReader"
                        }
                    }
                ],
                "responses": {
                    "201": {
                        "description": "Created",
                        "schema": {
                            "$ref": "#/definitions/main.Reader"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    }
                }
            }
        },
        "/readers/{id}": {
            "get": {
                "description": "Get a reader",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "get"
                ],
                "summary": "Get a reader",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Reader ID",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/main.Reader"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    }
                }
            },
            "delete": {
                "description": "Delete a reader",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "delete"
                ],
                "summary": "Delete a reader",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Reader ID",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPMessage"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    }
                }
            }
        },
        "/return": {
            "post": {
                "description": "Return a book",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "post"
                ],
                "summary": "Return a book",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Copy ID",
                        "name": "copy_id",
                        "in": "query",
                        "required": true
                    },
                    {
                        "type": "integer",
                        "description": "Reader ID",
                        "name": "reader_id",
                        "in": "query",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPMessage"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "$ref": "#/definitions/main.HTTPError"
                        }
                    }
                }
            }
        }
    },
    "definitions": {
        "main.Book": {
            "type": "object",
            "properties": {
                "author": {
                    "type": "string",
                    "example": "Kernighan Ritchie"
                },
                "id": {
                    "type": "integer",
                    "example": 1
                },
                "title": {
                    "type": "string",
                    "example": "The C Programming Language"
                }
            }
        },
        "main.BookCopy": {
            "type": "object",
            "properties": {
                "book_id": {
                    "type": "integer",
                    "example": 1
                },
                "copy_id": {
                    "type": "integer",
                    "example": 1
                },
                "reader_id": {
                    "type": "integer",
                    "example": 1
                }
            }
        },
        "main.HTTPError": {
            "type": "object",
            "properties": {
                "error": {
                    "type": "string"
                }
            }
        },
        "main.HTTPMessage": {
            "type": "object",
            "properties": {
                "message": {
                    "type": "string"
                }
            }
        },
        "main.NewBook": {
            "type": "object",
            "properties": {
                "author": {
                    "type": "string",
                    "example": "Kernighan Ritchie"
                },
                "title": {
                    "type": "string",
                    "example": "The C Programming Language"
                }
            }
        },
        "main.NewReader": {
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "example": "John"
                },
                "surname": {
                    "type": "string",
                    "example": "Doe"
                }
            }
        },
        "main.Reader": {
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "example": "John"
                },
                "reader_id": {
                    "type": "integer",
                    "example": 1
                },
                "surname": {
                    "type": "string",
                    "example": "Doe"
                }
            }
        }
    },
    "externalDocs": {
        "description": "OpenAPI",
        "url": "https://swagger.io/resources/open-api/"
    }
}`

// SwaggerInfo holds exported Swagger Info so clients can modify it
var SwaggerInfo = &amp;swag.Spec{
        Version:          "1.0",
        Host:             "localhost:8080",
        BasePath:         "/",
        Schemes:          []string{},
        Title:            "Library API",
        Description:      "This is a sample Library API.",
        InfoInstanceName: "swagger",
        SwaggerTemplate:  docTemplate,
        LeftDelim:        "{{",
        RightDelim:       "}}",
}

func init() <span class="cov8" title="1">{
        swag.Register(SwaggerInfo.InstanceName(), SwaggerInfo)
}</span>
</pre>
		
		<pre class="file" id="file1" style="display: none">package main

import (
        "net/http"
        "strconv"

        "github.com/gin-gonic/gin"
)

type HTTPMessage struct {
        Message string `json:"message"`
}

type HTTPError struct {
        Error string `json:"error"`
}

type HTTPServer struct {
        storage LibraryStorage
}

type NewBook struct {
        Title  string `json:"title" example:"The C Programming Language"`
        Author string `json:"author" example:"Kernighan Ritchie"`
}

// GetBooksHandler godoc
// @Summary Get all books
// @Description Get all books
// @Tags get
// @Accept json
// @Produce json
// @Success 200 {array} Book
// @Failure 500 {object} HTTPError
// @Router /books [get]
func (h *HTTPServer) GetBooksHandler(c *gin.Context) <span class="cov0" title="0">{
        books, err := h.storage.GetBooks()
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov0" title="0">c.JSON(http.StatusOK, books)</span>
}

// GetBookHandler godoc
// @Summary Get a book
// @Description Get a book
// @Tags get
// @Accept json
// @Produce json
// @Param id path int true "Book ID"
// @Success 200 {object} Book
// @Failure 400 {object} HTTPError
// @Failure 404 {object} HTTPError
// @Router /books/{id} [get]
func (h *HTTPServer) GetBookHandler(c *gin.Context) <span class="cov0" title="0">{
        id, err := strconv.Atoi(c.Param("id"))
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "Invalid book ID"})
                return
        }</span>
        <span class="cov0" title="0">book, err := h.storage.GetBook(id)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusNotFound, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov0" title="0">c.JSON(http.StatusOK, book)</span>
}

// CreateBookHandler godoc
// @Summary Create a new book
// @Description Create a new book
// @Tags create
// @Accept json
// @Produce json
// @Param book body NewBook true "HTTPError object"
// @Success 201 {object} HTTPMessage
// @Failure 400 {object} HTTPError
// @Failure 500 {object} HTTPError
// @Router /books [post]
func (h *HTTPServer) CreateBookHandler(c *gin.Context) <span class="cov0" title="0">{
        var book Book
        if err := c.ShouldBindJSON(&amp;book); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov0" title="0">if book.Title == "" || book.Author == "" </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "Both 'title' and 'author' body fields are required"})
                return
        }</span>

        <span class="cov0" title="0">if err := h.storage.CreateBook(&amp;book); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov0" title="0">c.JSON(http.StatusCreated, gin.H{"message": "book created", "book_id": book.ID})</span>
}

// DeleteBookHandler godoc
// @Summary Delete a book
// @Description Delete a book
// @Tags delete
// @Accept json
// @Produce json
// @Param id path int true "Book ID"
// @Success 200 {object} HTTPMessage
// @Failure 400 {object} HTTPError
// @Failure 500 {object} HTTPError
// @Router /books/{id} [delete]
func (h *HTTPServer) DeleteBookHandler(c *gin.Context) <span class="cov0" title="0">{
        id, err := strconv.Atoi(c.Param("id"))
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "Invalid book ID"})
                return
        }</span>
        <span class="cov0" title="0">if err = h.storage.DeleteBook(id); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov0" title="0">c.JSON(http.StatusOK, gin.H{"message": "book deleted"})</span>
}

// GetAllCopiesHandler godoc
// @Summary Get all copies
// @Description Get all copies
// @Tags get
// @Accept json
// @Produce json
// @Success 200 {array} BookCopy
// @Failure 500 {object} HTTPError
// @Router /copies [get]
func (h *HTTPServer) GetAllCopiesHandler(c *gin.Context) <span class="cov0" title="0">{
        copies, err := h.storage.GetCopies()
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov0" title="0">type FullCopy struct {
                CopyID    int  `json:"copy_id"`
                Available bool `json:"available"`
                Book
        }

        fullCopies := make([]*FullCopy, len(copies))
        for i, copy := range copies </span><span class="cov0" title="0">{
                book, err := h.storage.GetBook(copy.BookID)
                if err != nil </span><span class="cov0" title="0">{
                        c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                        return
                }</span>
                <span class="cov0" title="0">fullCopies[i] = &amp;FullCopy{copy.CopyID, copy.IsAvailable(), *book}</span>
        }

        <span class="cov0" title="0">c.JSON(http.StatusOK, fullCopies)</span>
}

// CreateCopyHandler godoc
// @Summary Create a new copy
// @Description Create a new copy
// @Tags create
// @Accept json
// @Produce json
// @Param id path int true "Book ID"
// @Success 201 {object} HTTPMessage
// @Failure 400 {object} HTTPError
// @Failure 500 {object} HTTPError
// @Router /books/{id}/copies [post]
func (h *HTTPServer) CreateCopyHandler(c *gin.Context) <span class="cov0" title="0">{
        bookID, err := strconv.Atoi(c.Param("id"))
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "Invalid book ID"})
                return
        }</span>
        <span class="cov0" title="0">copyID, err := h.storage.CreateCopy(bookID)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov0" title="0">c.JSON(http.StatusCreated, gin.H{"message": "copy added", "copy_id": copyID})</span>
}

// DeleteCopyHandler godoc
// @Summary Delete a copy
// @Description Delete a copy
// @Tags delete
// @Accept json
// @Produce json
// @Param id path int true "Copy ID"
// @Success 200 {object} HTTPMessage
// @Failure 400 {object} HTTPError
// @Failure 500 {object} HTTPError
// @Router /copies/{id} [delete]
func (h *HTTPServer) DeleteCopyHandler(c *gin.Context) <span class="cov0" title="0">{
        id, err := strconv.Atoi(c.Param("id"))
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "Invalid copy ID"})
                return
        }</span>
        <span class="cov0" title="0">if err = h.storage.DeleteCopy(id); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov0" title="0">c.JSON(http.StatusOK, gin.H{"message": "copy deleted"})</span>
}

// BorrowBookHandler godoc
// @Summary Borrow a book
// @Description Borrow a book
// @Tags post
// @Accept json
// @Produce json
// @Param book_id query int true "Book ID"
// @Param reader_id query int true "Reader ID"
// @Success 200 {object} HTTPMessage
// @Failure 400 {object} HTTPError
// @Failure 500 {object} HTTPError
// @Router /borrow [post]
func (h *HTTPServer) BorrowBookHandler(c *gin.Context) <span class="cov0" title="0">{
        bookID, err := strconv.Atoi(c.Query("book_id"))
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "Invalid book ID"})
                return
        }</span>

        <span class="cov0" title="0">readerID, err := strconv.Atoi(c.Query("reader_id"))
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "Invalid reader ID"})
                return
        }</span>

        <span class="cov0" title="0">_, err = h.storage.GetBook(bookID)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusNotFound, gin.H{"error": "Book not found"})
        }</span>

        <span class="cov0" title="0">_, err = h.storage.GetReader(readerID)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusNotFound, gin.H{"error": "Reader not found"})
        }</span>

        <span class="cov0" title="0">copies, err := h.storage.GetCopies()
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": "Failed to get copies"})
                return
        }</span>

        <span class="cov0" title="0">availableCopyID := 0
        for _, copy := range copies </span><span class="cov0" title="0">{
                if copy.BookID == bookID </span><span class="cov0" title="0">{
                        if copy.ReaderID == readerID </span><span class="cov0" title="0">{
                                c.JSON(http.StatusBadRequest, gin.H{"error": "Book already borrowed by this reader"})
                                return
                        }</span>
                        <span class="cov0" title="0">if copy.IsAvailable() </span><span class="cov0" title="0">{
                                availableCopyID = copy.CopyID
                        }</span>
                }
        }

        <span class="cov0" title="0">if availableCopyID == 0 </span><span class="cov0" title="0">{
                c.JSON(http.StatusNotFound, gin.H{"error": "No available copy"})
                return
        }</span>

        <span class="cov0" title="0">availableCopy, err := h.storage.GetCopy(availableCopyID)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": "Failed to get copy"})
                return
        }</span>

        <span class="cov0" title="0">err = availableCopy.Borrow(readerID)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov0" title="0">err = h.storage.UpdateCopy(availableCopy)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": "Failed to update copy"})
                return
        }</span>

        <span class="cov0" title="0">c.JSON(http.StatusOK, gin.H{"status": "book borrowed", "copy_id": availableCopyID})</span>
}

// ReturnBookHandler godoc
// @Summary Return a book
// @Description Return a book
// @Tags post
// @Accept json
// @Produce json
// @Param copy_id query int true "Copy ID"
// @Param reader_id query int true "Reader ID"
// @Success 200 {object} HTTPMessage
// @Failure 400 {object} HTTPError
// @Failure 500 {object} HTTPError
// @Router /return [post]
func (h *HTTPServer) ReturnBookHandler(c *gin.Context) <span class="cov0" title="0">{
        copyID, err := strconv.Atoi(c.Query("copy_id"))
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "Invalid copy ID"})
                return
        }</span>

        <span class="cov0" title="0">readerID, err := strconv.Atoi(c.Query("reader_id"))
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "Invalid reader ID"})
                return
        }</span>

        <span class="cov0" title="0">copy, err := h.storage.GetCopy(copyID)
        if err != nil || copy.ReaderID != readerID </span><span class="cov0" title="0">{
                c.JSON(http.StatusNotFound, gin.H{"error": "Copy not found or not borrowed by this reader"})
                return
        }</span>

        <span class="cov0" title="0">err = copy.Return(readerID)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov0" title="0">if err := h.storage.UpdateCopy(copy); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": "Failed to return book"})
                return
        }</span>

        <span class="cov0" title="0">c.JSON(http.StatusOK, gin.H{"status": "book returned"})</span>
}

// GetReadersHandler godoc
// @Summary Get all readers
// @Description Get all readers
// @Tags get
// @Accept json
// @Produce json
// @Success 200 {array} Reader
// @Failure 500 {object} HTTPError
// @Router /readers [get]
func (h *HTTPServer) GetReadersHandler(c *gin.Context) <span class="cov0" title="0">{
        readers, err := h.storage.GetReaders()
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov0" title="0">c.JSON(http.StatusOK, readers)</span>
}

// GetReaderHandler godoc
// @Summary Get a reader
// @Description Get a reader
// @Tags get
// @Accept json
// @Produce json
// @Param id path int true "Reader ID"
// @Success 200 {object} Reader
// @Failure 400 {object} HTTPError
// @Failure 404 {object} HTTPError
// @Failure 500 {object} HTTPError
// @Router /readers/{id} [get]
func (h *HTTPServer) GetReaderHandler(c *gin.Context) <span class="cov0" title="0">{
        id, err := strconv.Atoi(c.Param("id"))
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "Invalid reader ID"})
                return
        }</span>

        <span class="cov0" title="0">reader, err := h.storage.GetReader(id)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusNotFound, gin.H{"error": "Reader not found"})
        }</span>

        <span class="cov0" title="0">copies, err := h.storage.GetCopies()
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov0" title="0">var borrowedBooks []*FullCopy
        for _, copy := range copies </span><span class="cov0" title="0">{
                if copy.ReaderID == id </span><span class="cov0" title="0">{
                        book, err := h.storage.GetBook(copy.BookID)
                        if err == nil </span><span class="cov0" title="0">{
                                borrowedBooks = append(borrowedBooks, &amp;FullCopy{*book, *copy})
                        }</span>
                }
        }

        <span class="cov0" title="0">c.JSON(http.StatusOK, gin.H{"reader": reader, "books": borrowedBooks})</span>
}

type NewReader struct {
        Name    string `json:"name" example:"John"`
        Surname string `json:"surname" example:"Doe"`
}

// CreateReaderHandler godoc
// @Summary Create a new reader
// @Description Create a new reader
// @Tags create
// @Accept json
// @Produce json
// @Param reader body NewReader true "Reader object"
// @Success 201 {object} Reader
// @Failure 400 {object} HTTPError
// @Failure 500 {object} HTTPError
// @Router /readers [post]
func (h *HTTPServer) CreateReaderHandler(c *gin.Context) <span class="cov0" title="0">{
        var reader Reader
        if err := c.ShouldBindJSON(&amp;reader); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov0" title="0">if reader.Name == "" || reader.Surname == "" </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "Both 'name' and 'surname' body fields are required"})
                return
        }</span>

        <span class="cov0" title="0">if err := h.storage.CreateReader(&amp;reader); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov0" title="0">c.JSON(http.StatusCreated, reader)</span>
}

// DeleteReaderHandler godoc
// @Summary Delete a reader
// @Description Delete a reader
// @Tags delete
// @Accept json
// @Produce json
// @Param id path int true "Reader ID"
// @Success 200 {object} HTTPMessage
// @Failure 400 {object} HTTPError
// @Failure 500 {object} HTTPError
// @Router /readers/{id} [delete]
func (h *HTTPServer) DeleteReaderHandler(c *gin.Context) <span class="cov0" title="0">{
        id, err := strconv.Atoi(c.Param("id"))
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": "Invalid reader ID"})
                return
        }</span>
        <span class="cov0" title="0">if err = h.storage.DeleteReader(id); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov0" title="0">c.JSON(http.StatusOK, gin.H{"status": "reader deleted"})</span>
}
</pre>
		
		<pre class="file" id="file2" style="display: none">package main

import "errors"

type Book struct {
        ID     int    `json:"id" example:"1"`
        Title  string `json:"title" example:"The C Programming Language"`
        Author string `json:"author" example:"Kernighan Ritchie"`
}

type BookCopy struct {
        CopyID   int `json:"copy_id" example:"1"`
        BookID   int `json:"book_id" example:"1"`
        ReaderID int `json:"reader_id" example:"1"`
}

func (bc *BookCopy) IsAvailable() bool <span class="cov8" title="1">{
        return bc.ReaderID == 0
}</span>

func (bc *BookCopy) Borrow(readerID int) error <span class="cov8" title="1">{
        if !bc.IsAvailable() </span><span class="cov8" title="1">{
                return ErrBookCopyNotAvaialble
        }</span>
        <span class="cov8" title="1">bc.ReaderID = readerID
        return nil</span>
}

func (bc *BookCopy) Return(readerID int) error <span class="cov8" title="1">{
        if bc.IsAvailable() || bc.ReaderID != readerID </span><span class="cov8" title="1">{
                return ErrBookNotBorrowed
        }</span>
        <span class="cov8" title="1">bc.ReaderID = 0
        return nil</span>
}

type Reader struct {
        ReaderID int    `json:"reader_id" example:"1"`
        Name     string `json:"name" example:"John"`
        Surname  string `json:"surname" example:"Doe"`
}

type FullCopy struct {
        Book
        BookCopy
}

type LibraryService interface {
        GetCopiesByReader(readerID int) ([]*FullCopy, error)
        BorrowBook(bookID int, readerID int) error
        ReturnBook(bookID int, readerID int) error
}

type BookStorage interface {
        GetBooks() ([]*Book, error)
        GetBook(id int) (*Book, error)
        CreateBook(book *Book) error
        DeleteBook(id int) error
        GetCopies() ([]*BookCopy, error)
        GetCopy(id int) (*BookCopy, error)
        CreateCopy(bookID int) (int, error)
        UpdateCopy(*BookCopy) error
        DeleteCopy(id int) error
}

type ReaderStorage interface {
        CreateReader(reader *Reader) error
        DeleteReader(id int) error
        GetReaders() ([]*Reader, error)
        GetReader(id int) (*Reader, error)
}

type LibraryStorage interface {
        BookStorage
        ReaderStorage
}

var (
        ErrBookNotFound         = errors.New("book not found")
        ErrBookCopyNotFound     = errors.New("book copy not found")
        ErrBookCopyNotAvaialble = errors.New("book copy not available")
        ErrBookNotBorrowed      = errors.New("book not borrowed")
        ErrBookAlreadyBorrowed  = errors.New("book already borrowed")
        ErrReaderNotFound       = errors.New("reader not found")
)
</pre>
		
		<pre class="file" id="file3" style="display: none">package main

import (
        "github.com/gin-gonic/gin"

        swaggerFiles "github.com/swaggo/files"
        ginSwagger "github.com/swaggo/gin-swagger"

        _ "rwlodarczyk.pl/library/docs"
)

func populate(s LibraryStorage) <span class="cov0" title="0">{
        // Create readers
        readers := []Reader{
                {Name: "Michał", Surname: "Wiśniewski"},
                {Name: "Till", Surname: "Lindemann"},
                {Name: "Freddie", Surname: "Mercury"},
                {Name: "Eric", Surname: "Clapton"},
                {Name: "David", Surname: "Gilmour"},
        }

        for _, r := range readers </span><span class="cov0" title="0">{
                err := s.CreateReader(&amp;r)
                if err != nil </span><span class="cov0" title="0">{
                        panic(err)</span>
                }
        }

        // Create classical literature books
        <span class="cov0" title="0">classicalBooks := []Book{
                {Title: "Catch-22", Author: "Joseph Heller"},
                {Title: "Fight Club", Author: "Chuck Palahniuk"},
                {Title: "1984", Author: "George Orwell"},
                {Title: "Brave New World", Author: "Aldous Huxley"},
                {Title: "Memoirs from the house of the dead", Author: "Fyodor Dostoevsky"},
        }

        for _, b := range classicalBooks </span><span class="cov0" title="0">{
                err := s.CreateBook(&amp;b)
                if err != nil </span><span class="cov0" title="0">{
                        panic(err)</span>
                }
        }

        // Create 3 copies of each book
        <span class="cov0" title="0">for i := 1; i &lt; 6; i++ </span><span class="cov0" title="0">{
                _, err := s.CreateCopy(i)
                if err != nil </span><span class="cov0" title="0">{
                        panic(err)</span>
                }
                <span class="cov0" title="0">_, err = s.CreateCopy(i)
                if err != nil </span><span class="cov0" title="0">{
                        panic(err)</span>
                }
                <span class="cov0" title="0">_, err = s.CreateCopy(i)
                if err != nil </span><span class="cov0" title="0">{
                        panic(err)</span>
                }
        }

}

// @title           Library API
// @version         1.0
// @description     This is a sample Library API.
// @termsOfService  https://github.com/Rafisto/uni

// @contact.name   API Support
// @contact.url    https://github.com/Rafisto
// @contact.email  rvrelay@gmail.com

// @host      localhost:8080
// @BasePath  /

// @externalDocs.description  OpenAPI
// @externalDocs.url          https://swagger.io/resources/open-api/
func main() <span class="cov0" title="0">{
        storage := NewInMemoryStorage()

        populate(storage)

        server := &amp;HTTPServer{storage: storage}

        router := gin.Default()

        router.GET("/books", server.GetBooksHandler)
        router.GET("/books/:id", server.GetBookHandler)
        router.POST("/books", server.CreateBookHandler)
        router.DELETE("/books/:id", server.DeleteBookHandler)

        router.POST("/books/:id/copies", server.CreateCopyHandler)
        router.GET("/copies", server.GetAllCopiesHandler)
        router.DELETE("/copies/:id", server.DeleteCopyHandler)

        router.POST("/borrow", server.BorrowBookHandler)
        router.POST("/return", server.ReturnBookHandler)

        router.GET("/readers", server.GetReadersHandler)
        router.GET("/readers/:id", server.GetReaderHandler)
        router.POST("/readers", server.CreateReaderHandler)
        router.DELETE("/readers/:id", server.DeleteReaderHandler)

        router.GET("/docs/*any", ginSwagger.WrapHandler(swaggerFiles.Handler))

        res := router.Run(":8080")
        if res != nil </span><span class="cov0" title="0">{
                panic(res)</span>
        }
}
</pre>
		
		<pre class="file" id="file4" style="display: none">package main

import (
        "sync"
)

// General Storage

var _ LibraryStorage = (*InMemoryStorage)(nil)

type InMemoryStorage struct {
        *InMemoryBookStorage
        *InMemoryReaderStorage
}

func NewInMemoryStorage() *InMemoryStorage <span class="cov8" title="1">{
        return &amp;InMemoryStorage{
                InMemoryBookStorage:   NewInMemoryBookStorage(),
                InMemoryReaderStorage: NewInMemoryReaderStorage(),
        }
}</span>

var _ BookStorage = (*InMemoryBookStorage)(nil)
var _ ReaderStorage = (*InMemoryReaderStorage)(nil)

// Book Storage

type InMemoryBookStorage struct {
        books  map[int]*Book
        copies map[int]*BookCopy
        nextID int
        copyID int
        mu     sync.Mutex
}

func NewInMemoryBookStorage() *InMemoryBookStorage <span class="cov8" title="1">{
        return &amp;InMemoryBookStorage{
                books:  make(map[int]*Book),
                copies: make(map[int]*BookCopy),
                nextID: 1,
                copyID: 1,
                mu:     sync.Mutex{},
        }
}</span>

func (s *InMemoryBookStorage) GetBooks() ([]*Book, error) <span class="cov8" title="1">{
        s.mu.Lock()
        defer s.mu.Unlock()

        books := make([]*Book, 0, len(s.books))
        for _, book := range s.books </span><span class="cov8" title="1">{
                books = append(books, book)
        }</span>
        <span class="cov8" title="1">return books, nil</span>
}

func (s *InMemoryBookStorage) GetBook(id int) (*Book, error) <span class="cov8" title="1">{
        s.mu.Lock()
        defer s.mu.Unlock()

        book, exists := s.books[id]
        if !exists </span><span class="cov8" title="1">{
                return nil, ErrBookNotFound
        }</span>
        <span class="cov8" title="1">return book, nil</span>
}

func (s *InMemoryBookStorage) GetCopies() ([]*BookCopy, error) <span class="cov0" title="0">{
        s.mu.Lock()
        defer s.mu.Unlock()

        copies := make([]*BookCopy, 0)
        for _, copy := range s.copies </span><span class="cov0" title="0">{
                copies = append(copies, copy)
        }</span>

        <span class="cov0" title="0">return copies, nil</span>
}

func (s *InMemoryBookStorage) GetCopy(id int) (*BookCopy, error) <span class="cov0" title="0">{
        s.mu.Lock()
        defer s.mu.Unlock()

        bookCopy, exists := s.copies[id]
        if !exists </span><span class="cov0" title="0">{
                return nil, ErrBookCopyNotFound
        }</span>
        <span class="cov0" title="0">return bookCopy, nil</span>
}

func (s *InMemoryBookStorage) CreateBook(book *Book) error <span class="cov8" title="1">{
        s.mu.Lock()
        defer s.mu.Unlock()

        book.ID = s.nextID
        s.nextID++
        s.books[book.ID] = book
        return nil
}</span>

func (s *InMemoryBookStorage) DeleteBook(id int) error <span class="cov8" title="1">{
        s.mu.Lock()
        defer s.mu.Unlock()

        if _, exists := s.books[id]; !exists </span><span class="cov8" title="1">{
                return ErrBookNotFound
        }</span>
        <span class="cov8" title="1">delete(s.books, id)
        return nil</span>
}

func (s *InMemoryBookStorage) CreateCopy(bookID int) (int, error) <span class="cov8" title="1">{
        s.mu.Lock()
        defer s.mu.Unlock()

        if _, exists := s.books[bookID]; !exists </span><span class="cov8" title="1">{
                return 0, ErrBookNotFound
        }</span>
        <span class="cov8" title="1">copyID := s.copyID
        s.copyID++
        s.copies[copyID] = &amp;BookCopy{CopyID: copyID, BookID: bookID, ReaderID: 0}
        return copyID, nil</span>
}

func (s *InMemoryBookStorage) UpdateCopy(copy *BookCopy) error <span class="cov0" title="0">{
        s.mu.Lock()
        defer s.mu.Unlock()

        if _, exists := s.copies[copy.CopyID]; !exists </span><span class="cov0" title="0">{
                return ErrBookCopyNotFound
        }</span>
        <span class="cov0" title="0">s.copies[copy.CopyID] = copy
        return nil</span>
}

func (s *InMemoryBookStorage) DeleteCopy(id int) error <span class="cov8" title="1">{
        s.mu.Lock()
        defer s.mu.Unlock()

        if _, exists := s.copies[id]; !exists </span><span class="cov8" title="1">{
                return ErrBookCopyNotFound
        }</span>
        <span class="cov8" title="1">delete(s.copies, id)
        return nil</span>
}

// Reader Storage

type InMemoryReaderStorage struct {
        readers map[int]*Reader
        nextID  int
        mu      sync.Mutex
}

func NewInMemoryReaderStorage() *InMemoryReaderStorage <span class="cov8" title="1">{
        return &amp;InMemoryReaderStorage{
                readers: make(map[int]*Reader),
                nextID:  1,
                mu:      sync.Mutex{},
        }
}</span>

func (s *InMemoryReaderStorage) GetReaders() ([]*Reader, error) <span class="cov0" title="0">{
        s.mu.Lock()
        defer s.mu.Unlock()

        readers := make([]*Reader, 0, len(s.readers))
        for _, reader := range s.readers </span><span class="cov0" title="0">{
                readers = append(readers, reader)
        }</span>
        <span class="cov0" title="0">return readers, nil</span>
}

func (s *InMemoryReaderStorage) GetReader(id int) (*Reader, error) <span class="cov0" title="0">{
        s.mu.Lock()
        defer s.mu.Unlock()

        reader, exists := s.readers[id]
        if !exists </span><span class="cov0" title="0">{
                return nil, ErrReaderNotFound
        }</span>

        <span class="cov0" title="0">return reader, nil</span>
}

func (s *InMemoryReaderStorage) CreateReader(reader *Reader) error <span class="cov8" title="1">{
        s.mu.Lock()
        defer s.mu.Unlock()

        reader.ReaderID = s.nextID
        s.nextID++
        s.readers[reader.ReaderID] = reader
        return nil
}</span>

func (s *InMemoryReaderStorage) DeleteReader(id int) error <span class="cov8" title="1">{
        s.mu.Lock()
        defer s.mu.Unlock()

        if _, exists := s.readers[id]; !exists </span><span class="cov8" title="1">{
                return ErrReaderNotFound
        }</span>
        <span class="cov8" title="1">delete(s.readers, id)
        return nil</span>
}
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
